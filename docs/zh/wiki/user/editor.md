# 游戏内编辑器

CraftMenu 包含一个强大的可视化编辑器，允许您通过物品栏 GUI 直接配置菜单，无需手动编辑 YAML 文件。

## 入门

### 打开编辑器

```
/cm bianji              # 打开主编辑器中心
/cm bianji <menu>       # 直接编辑特定菜单
```

**所需权限:** `craftmenu.admin` 或 `craftmenu.edit`

### 编辑器导航

编辑器使用**基于堆栈的导航**系统:
- **左键点击** 进入子菜单或编辑值
- **右键点击** 执行辅助操作（预览、测试）
- **Shift + 左键点击** 删除项目（需要确认）
- **箭头图标**（返回按钮）返回上一个菜单
- **关闭物品栏** 或点击外部退出

---

## 编辑器主菜单

运行 `/cm bianji` 时，您将看到包含以下选项的主编辑器中心:

| 项目 | 描述 |
|-----|------|
| **菜单列表** | 浏览和编辑所有已加载的菜单 |
| **图像浏览器** | 查看所有可用图像 |
| **声音浏览器** | 查看所有可用声音 |
| **配置** | 全局插件配置 |

---

## 菜单编辑

### 菜单列表

显示 `menus/` 文件夹中的所有菜单。点击菜单打开其编辑器。

- **左键点击**: 编辑菜单
- **Shift + 左键点击**: 删除菜单（需要确认）
- **新建**: 在当前位置添加新菜单

### 菜单操作中心

选择菜单后，您将看到包含以下部分的主菜单编辑器:

| 部分 | 描述 |
|-----|------|
| **属性** | 基本设置（名称、标题、主菜单、自动打开） |
| **位置** | 世界位置和旋转 |
| **布局** | 网格布局配置 |
| **快捷键** | 键盘快捷键 |
| **可见性** | 隐藏玩家/怪物/物品设置 |
| **高级** | 光标灵敏度、摄像机锁定、边界 |
| **组件** | 编辑此菜单中的组件 |

---

## 菜单属性

编辑基本菜单信息:

| 属性 | 描述 |
|-----|------|
| **名称** | 菜单标识符（在命令中使用） |
| **标题** | 显示标题（支持 & 颜色代码） |
| **描述** | 可选描述 |
| **主菜单** | 标记为主菜单 |
| **加入时打开** | 玩家加入服务器时自动打开 |
| **传送时打开** | 玩家传送到此世界时自动打开 |
| **世界** | 菜单所在的世界 |

### 编辑文本值

点击文本属性时:
1. 物品栏关闭
2. 聊天框中出现提示
3. 在聊天中输入新值
4. 按 Enter 确认（或输入 `cancel` 取消）

---

## 菜单位置

配置菜单在世界中显示的位置:

| 属性 | 描述 |
|-----|------|
| **世界** | 从可用世界中选择 |
| **X / Y / Z** | 坐标（点击通过聊天编辑） |
| **Yaw** | 水平旋转（-180 到 180） |
| **Pitch** | 垂直旋转（-90 到 90） |
| **设为当前位置** | 使用您当前的位置/旋转 |

---

## 菜单布局（网格）

配置基于网格的组件定位:

| 属性 | 描述 |
|-----|------|
| **启用** | 开启/关闭网格布局 |
| **列数** | 网格列数 |
| **行数** | 网格行数 |
| **间距 X / Y / Z** | 单元格之间的间距 |
| **对齐** | 网格对齐方式（CENTER、TOP_LEFT 等） |

启用网格布局后，组件使用 `grid-position: {row: X, col: Y}` 而不是手动坐标。

---

## 菜单快捷键

配置键盘快捷键:

| 操作 | 描述 |
|-----|------|
| **添加快捷键** | 创建新的键盘快捷键 |
| **编辑快捷键** | 修改现有快捷键 |
| **删除快捷键** | 移除快捷键 |

### 快捷键属性

- **按键**: 按键或组合（例如：`SHIFT`、`CTRL+E`、`F`）
- **动作**: `activate`、`toggle` 或 `close`
- **组件**: 目标组件名称（用于 activate/toggle）

---

## 菜单可见性

控制菜单打开时可见的内容:

| 属性 | 描述 |
|-----|------|
| **隐藏玩家** | 隐藏其他玩家 |
| **隐藏怪物** | 隐藏所有怪物 |
| **隐藏物品** | 隐藏地面上的物品 |
| **白名单** | 保持可见的玩家（编辑列表） |

---

## 高级设置

微调菜单行为:

| 属性 | 描述 |
|-----|------|
| **光标灵敏度** | 鼠标移动速度（0.1 - 5.0） |
| **最大 Yaw 偏移** | 水平光标边界（度） |
| **最大 Pitch 偏移** | 垂直光标边界（度） |
| **启用摄像机锁定** | 菜单打开时锁定玩家摄像机 |
| **摄像机锁定强度** | 摄像机锁定的强度（0.0 - 1.0） |
| **边界声音** | 光标触碰边界时的声音 |
| **边界音量/音调** | 声音属性 |
| **边界消息** | 在边界处显示的消息 |

---

## 组件编辑

### 组件列表

显示当前菜单中的所有组件:

- **左键点击**: 编辑组件
- **Shift + 左键点击**: 删除组件
- **新建**: 添加新组件

### 组件编辑器中心

每个组件都有以下可编辑部分:

| 部分 | 描述 |
|-----|------|
| **类型** | IMAGE、TEXT 或 CURSOR |
| **变换** | 位置、大小、旋转 |
| **视觉状态** | 正常、悬停、按下、禁用外观 |
| **碰撞** | 碰撞盒配置 |
| **事件** | 交互事件和动作 |
| **[类型特定]** | 基于组件类型的附加选项 |

---

## 变换编辑器

配置组件的定位和大小:

### 位置
- **X**: 水平位置
- **Y**: 垂直位置
- **Z**: 深度位置

### 大小
- **X**: 宽度缩放
- **Y**: 高度缩放
- **Z**: 深度缩放

### 旋转
- **Pitch**: 上下旋转
- **Yaw**: 左右旋转
- **Roll**: 倾斜旋转

**提示**: 点击任何值可通过聊天输入进行编辑。

---

## 视觉状态

组件可以针对不同状态具有不同的外观:

| 状态 | 应用时机 |
|-----|---------|
| **normal** | 默认状态 |
| **hover** | 光标在组件上 |
| **pressed** | 组件正在被点击 |
| **disabled** | 组件处于非活动状态 |
| **自定义** | 任何自定义状态名称 |

### 视觉状态编辑器

每个状态包含:

| 属性 | 描述 |
|-----|------|
| **类型** | `image`、`text` 或 `unicode` |
| **值** | 图像路径、文本内容或 Unicode 字符 |
| **覆盖** | 可选的变换/碰撞/文本大小覆盖 |

---

## 碰撞编辑器

配置组件的可点击区域:

| 属性 | 描述 |
|-----|------|
| **启用** | 开启/关闭碰撞检测 |
| **位置 X/Y/Z** | 碰撞盒中心偏移 |
| **大小 X/Y/Z** | 碰撞盒尺寸 |
| **偏移 X/Y/Z** | 附加偏移 |

**提示**: 使用 `/cm tiaoshi particles` 在游戏中可视化碰撞盒。

---

## 事件编辑器

### 事件类型

| 事件 | 触发条件 |
|-----|---------|
| **on_menu_open** | 菜单打开时 |
| **on_cursor_hover** | 光标进入组件时 |
| **on_cursor_hover_exit** | 光标离开组件时 |
| **on_cursor_click** | 组件被点击时 |

### 动作列表

每个事件包含按顺序执行的动作列表:

- **左键点击**: 编辑动作
- **Shift + 左键点击**: 删除动作
- **添加动作**: 创建新动作
- **重新排序**: 拖动以更改执行顺序

---

## 动作编辑器

每种动作类型都有专门的编辑器:

### 动画动作

| 属性 | 描述 |
|-----|------|
| **效果** | 动画类型（rotate、scale、bounce 等） |
| **持续时间** | 动画时长（毫秒） |
| **缩放 X/Y/Z** | 缩放倍数（用于缩放动画） |
| **强度** | 效果强度（0.1 - 5.0） |
| **缓动** | 时间函数（linear、ease_in、ease_out 等） |
| **优先级** | 动画期间阻止交互 |

### 声音动作

| 属性 | 描述 |
|-----|------|
| **文件** | 声音路径（minecraft:... 或自定义路径） |
| **音量** | 声音音量（0.0 - 1.0） |
| **音调** | 声音音调（0.5 - 2.0） |

**浏览**: 点击打开声音浏览器并选择声音。

### 命令动作

| 属性 | 描述 |
|-----|------|
| **命令** | 要执行的命令（支持特殊命令） |
| **延迟** | 执行前的延迟（毫秒） |

**特殊命令:**
- `[TELEPORT] world x y z yaw pitch`
- `[MESSAGE] &a您的消息`
- `[CLOSE]`
- `[PLAY_MUSIC] path/file.ogg`
- `[STOP_MUSIC]`
- `[OPEN_URL] https://...`
- `[PLAYER] /command`
- `[CONSOLE] /command`

### 状态动作

| 属性 | 描述 |
|-----|------|
| **动作类型** | `toggle_state` 或 `set_state` |
| **状态列表** | 要切换的状态列表（toggle_state） |
| **状态** | 目标状态名称（set_state） |

### 视觉变更动作

| 属性 | 描述 |
|-----|------|
| **To** | 目标视觉状态名称 |

### 组件动作

| 属性 | 描述 |
|-----|------|
| **动作** | `hide_widget`、`show_widget` 等 |
| **组件** | 目标组件名称 |

### 效果动作

| 属性 | 描述 |
|-----|------|
| **效果** | 要应用的效果类型 |
| **参数** | 效果特定参数 |

### 停止动画动作

| 属性 | 描述 |
|-----|------|
| **动画类型** | 要停止的动画 |

### 停止效果动作

| 属性 | 描述 |
|-----|------|
| **效果类型** | 要停止的效果 |

### 设置基础状态动作

| 属性 | 描述 |
|-----|------|
| **状态** | 组件的新基础状态 |

---

## 资源浏览器

### 图像浏览器

浏览 `images/` 文件夹中的所有图像:

- **分页**: 浏览图像页面
- **预览**: 查看图像路径和详细信息
- **选择**: 点击在当前上下文中使用

图像按文件夹组织（例如：`template/button.png`）。

### 声音浏览器

浏览 `sounds/` 文件夹中的所有声音以及 Minecraft 内置声音:

- **自定义声音**: `sounds/` 中的 .ogg 文件
- **Minecraft 声音**: 内置声音（minecraft:ui.button.click 等）
- **选择**: 点击在当前上下文中使用

---

## 提示和最佳实践

### 工作流程提示

1. **从属性开始**: 首先设置名称、标题和位置
2. **添加组件**: 使用基本变换创建组件
3. **配置视觉效果**: 设置正常和悬停状态
4. **添加碰撞**: 启用碰撞盒并调整大小
5. **添加事件**: 配置悬停声音和点击动作
6. **经常测试**: 使用 `/cm dakai <menu>` 测试更改

### 键盘快捷键

| 快捷键 | 操作 |
|-------|-----|
| **Escape** | 关闭编辑器 |
| **数字键 (1-9)** | 快速选择槽位 |

### 常见问题

**更改未显示:**
- 更改后运行 `/cm chongzai`
- 确保在编辑器中点击了"保存"

**碰撞未检测:**
- 检查碰撞是否已启用
- 验证碰撞大小是否足够大
- 使用 `/cm tiaoshi particles` 进行可视化

**图像未显示:**
- 运行 `/cm dabao` 重新生成资源包
- 确保图像在子文件夹中（例如：`images/mymenu/`）
- 将资源包应用到客户端

---

## 另请参阅

- [命令参考](commands.md)
- [创建菜单](menu-creation.md)
- [组件类型](widgets.md)
- [事件系统](events.md)
- [动画](animations.md)
