# ゲーム内エディター

CraftMenuには、YAMLファイルを手動で編集することなく、インベントリGUIから直接メニューを設定できる強力なビジュアルエディターが含まれています。

## はじめに

### エディターを開く

```
/cm edita              # メインエディターハブを開く
/cm edita <menu>       # 特定のメニューを直接編集する
```

**必要な権限:** `craftmenu.admin` または `craftmenu.edit`

### エディターのナビゲーション

エディターは**スタックベースのナビゲーション**システムを使用します:
- **左クリック** でサブメニューに入るか、値を編集
- **右クリック** で補助アクション（プレビュー、テスト）
- **Shift + 左クリック** でアイテムを削除（確認あり）
- **矢印アイテム**（戻るボタン）で前のメニューに戻る
- **インベントリを閉じる** または外側をクリックして終了

---

## エディターメインメニュー

`/cm edita`を実行すると、以下のオプションを持つメインエディターハブが表示されます:

| アイテム | 説明 |
|---------|------|
| **メニューリスト** | 読み込まれたすべてのメニューを閲覧・編集 |
| **画像ブラウザ** | 利用可能なすべての画像を表示 |
| **サウンドブラウザ** | 利用可能なすべてのサウンドを表示 |
| **設定** | プラグインのグローバル設定 |

---

## メニュー編集

### メニューリスト

`menus/`フォルダ内のすべてのメニューを表示します。メニューをクリックしてエディターを開きます。

- **左クリック**: メニューを編集
- **Shift + 左クリック**: メニューを削除（確認あり）
- **新規作成**: 現在の位置に新しいメニューを追加

### メニューアクションハブ

メニューを選択すると、以下のセクションを持つメインメニューエディターが表示されます:

| セクション | 説明 |
|-----------|------|
| **プロパティ** | 基本設定（名前、タイトル、メインメニュー、自動オープン） |
| **ロケーション** | ワールドの位置と回転 |
| **レイアウト** | グリッドレイアウト設定 |
| **キーバインド** | キーボードショートカット |
| **可視性** | プレイヤー/モブ/アイテムを隠す設定 |
| **詳細設定** | カーソル感度、カメラロック、境界 |
| **ウィジェット** | このメニューのウィジェットを編集 |

---

## メニュープロパティ

基本的なメニュー情報を編集:

| プロパティ | 説明 |
|-----------|------|
| **名前** | メニュー識別子（コマンドで使用） |
| **タイトル** | 表示タイトル（&カラーコード対応） |
| **説明** | オプションの説明 |
| **メインメニュー** | プライマリメニューとしてマーク |
| **参加時に開く** | プレイヤーがサーバーに参加したときに自動で開く |
| **テレポート時に開く** | プレイヤーがこのワールドにテレポートしたときに自動で開く |
| **ワールド** | メニューが存在するワールド |

### テキスト値の編集

テキストプロパティをクリックすると:
1. インベントリが閉じます
2. チャットにプロンプトが表示されます
3. チャットに新しい値を入力します
4. Enterを押して確認（または`cancel`と入力して中止）

---

## メニューロケーション

メニューがワールドに表示される場所を設定:

| プロパティ | 説明 |
|-----------|------|
| **ワールド** | 利用可能なワールドから選択 |
| **X / Y / Z** | 座標（クリックしてチャットで編集） |
| **ヨー** | 水平回転（-180から180） |
| **ピッチ** | 垂直回転（-90から90） |
| **現在位置に設定** | 現在の位置/回転を使用 |

---

## メニューレイアウト（グリッド）

グリッドベースのウィジェット配置を設定:

| プロパティ | 説明 |
|-----------|------|
| **有効** | グリッドレイアウトのオン/オフを切り替え |
| **列数** | グリッドの列数 |
| **行数** | グリッドの行数 |
| **間隔 X / Y / Z** | セル間のスペース |
| **配置** | グリッドの配置（CENTER、TOP_LEFTなど） |

グリッドレイアウトが有効な場合、ウィジェットは手動座標の代わりに`grid-position: {row: X, col: Y}`を使用します。

---

## メニューキーバインド

キーボードショートカットを設定:

| アクション | 説明 |
|-----------|------|
| **キーバインドを追加** | 新しいキーボードショートカットを作成 |
| **キーバインドを編集** | 既存のキーバインドを変更 |
| **キーバインドを削除** | キーバインドを削除 |

### キーバインドのプロパティ

- **キー**: キーまたは組み合わせ（例: `SHIFT`、`CTRL+E`、`F`）
- **アクション**: `activate`、`toggle`、または`close`
- **ウィジェット**: ターゲットウィジェット名（activate/toggle用）

---

## メニュー可視性

メニューが開いている間の表示を制御:

| プロパティ | 説明 |
|-----------|------|
| **プレイヤーを隠す** | 他のプレイヤーを非表示 |
| **モブを隠す** | すべてのモブを非表示 |
| **アイテムを隠す** | 地面のアイテムを非表示 |
| **ホワイトリスト** | 表示を維持するプレイヤー（リストを編集） |

---

## 詳細設定

メニューの動作を微調整:

| プロパティ | 説明 |
|-----------|------|
| **カーソル感度** | マウス移動速度（0.1 - 5.0） |
| **最大ヨーオフセット** | 水平カーソル境界（度） |
| **最大ピッチオフセット** | 垂直カーソル境界（度） |
| **カメラロック有効** | メニューが開いている間プレイヤーのカメラをロック |
| **カメラロック強度** | カメラがどの程度強くロックされるか（0.0 - 1.0） |
| **境界サウンド** | カーソルが境界に達したときのサウンド |
| **境界音量/ピッチ** | サウンドのプロパティ |
| **境界メッセージ** | 境界で表示されるメッセージ |

---

## ウィジェット編集

### ウィジェットリスト

現在のメニューのすべてのウィジェットを表示:

- **左クリック**: ウィジェットを編集
- **Shift + 左クリック**: ウィジェットを削除
- **新規作成**: 新しいウィジェットを追加

### ウィジェットエディターハブ

各ウィジェットには以下の編集可能なセクションがあります:

| セクション | 説明 |
|-----------|------|
| **タイプ** | IMAGE、TEXT、またはCURSOR |
| **トランスフォーム** | 位置、サイズ、回転 |
| **ビジュアルステート** | 通常、ホバー、押下、無効の外観 |
| **コリジョン** | コリジョンボックスの設定 |
| **イベント** | インタラクションイベントとアクション |
| **[タイプ別]** | ウィジェットタイプに基づく追加オプション |

---

## トランスフォームエディター

ウィジェットの位置とサイズを設定:

### 位置
- **X**: 水平位置
- **Y**: 垂直位置
- **Z**: 深度位置

### サイズ
- **X**: 幅スケール
- **Y**: 高さスケール
- **Z**: 深度スケール

### 回転
- **ピッチ**: 上下回転
- **ヨー**: 左右回転
- **ロール**: 傾き回転

**ヒント**: 任意の値をクリックしてチャット入力で編集できます。

---

## ビジュアルステート

ウィジェットは異なる状態に対して異なる外観を持つことができます:

| ステート | 適用タイミング |
|---------|--------------|
| **normal** | デフォルト状態 |
| **hover** | カーソルがウィジェット上にある |
| **pressed** | ウィジェットがクリックされている |
| **disabled** | ウィジェットが非アクティブ |
| **カスタム** | 任意のカスタムステート名 |

### ビジュアルステートエディター

各ステートには以下があります:

| プロパティ | 説明 |
|-----------|------|
| **タイプ** | `image`、`text`、または`unicode` |
| **値** | 画像パス、テキスト内容、またはユニコード文字 |
| **オーバーライド** | オプションのトランスフォーム/コリジョン/テキストサイズのオーバーライド |

---

## コリジョンエディター

ウィジェットのクリック可能領域を設定:

| プロパティ | 説明 |
|-----------|------|
| **有効** | コリジョン検出の切り替え |
| **位置 X/Y/Z** | コリジョンボックスの中心オフセット |
| **サイズ X/Y/Z** | コリジョンボックスの寸法 |
| **オフセット X/Y/Z** | 追加オフセット |

**ヒント**: `/cm debaggu particles`を使用してゲーム内でコリジョンボックスを視覚化できます。

---

## イベントエディター

### イベントタイプ

| イベント | トリガー |
|---------|---------|
| **on_menu_open** | メニューが開いたとき |
| **on_cursor_hover** | カーソルがウィジェットに入ったとき |
| **on_cursor_hover_exit** | カーソルがウィジェットを離れたとき |
| **on_cursor_click** | ウィジェットがクリックされたとき |

### アクションリスト

各イベントには順番に実行されるアクションのリストが含まれます:

- **左クリック**: アクションを編集
- **Shift + 左クリック**: アクションを削除
- **アクションを追加**: 新しいアクションを作成
- **並べ替え**: ドラッグして実行順序を変更

---

## アクションエディター

各アクションタイプには専用のエディターがあります:

### アニメーションアクション

| プロパティ | 説明 |
|-----------|------|
| **エフェクト** | アニメーションタイプ（rotate、scale、bounceなど） |
| **時間** | アニメーションの長さ（ミリ秒） |
| **スケール X/Y/Z** | スケール乗数（スケールアニメーション用） |
| **強度** | エフェクトの強さ（0.1 - 5.0） |
| **イージング** | タイミング関数（linear、ease_in、ease_outなど） |
| **優先度** | アニメーション中のインタラクションをブロック |

### サウンドアクション

| プロパティ | 説明 |
|-----------|------|
| **ファイル** | サウンドパス（minecraft:...またはカスタムパス） |
| **音量** | サウンドの音量（0.0 - 1.0） |
| **ピッチ** | サウンドのピッチ（0.5 - 2.0） |

**ブラウズ**: クリックしてサウンドブラウザを開き、サウンドを選択します。

### コマンドアクション

| プロパティ | 説明 |
|-----------|------|
| **コマンド** | 実行するコマンド（特殊コマンド付き） |
| **遅延** | 実行前の遅延（ミリ秒） |

**特殊コマンド:**
- `[TELEPORT] world x y z yaw pitch`
- `[MESSAGE] &aあなたのメッセージ`
- `[CLOSE]`
- `[PLAY_MUSIC] path/file.ogg`
- `[STOP_MUSIC]`
- `[OPEN_URL] https://...`
- `[PLAYER] /command`
- `[CONSOLE] /command`

### ステートアクション

| プロパティ | 説明 |
|-----------|------|
| **アクションタイプ** | `toggle_state`または`set_state` |
| **ステート** | 切り替えるステートのリスト（toggle_state） |
| **ステート** | ターゲットステート名（set_state） |

### ビジュアル変更アクション

| プロパティ | 説明 |
|-----------|------|
| **To** | ターゲットビジュアルステート名 |

### ウィジェットアクション

| プロパティ | 説明 |
|-----------|------|
| **アクション** | `hide_widget`、`show_widget`など |
| **ウィジェット** | ターゲットウィジェット名 |

### エフェクトアクション

| プロパティ | 説明 |
|-----------|------|
| **エフェクト** | 適用するエフェクトタイプ |
| **パラメーター** | エフェクト固有のパラメーター |

### アニメーション停止アクション

| プロパティ | 説明 |
|-----------|------|
| **アニメーションタイプ** | 停止するアニメーション |

### エフェクト停止アクション

| プロパティ | 説明 |
|-----------|------|
| **エフェクトタイプ** | 停止するエフェクト |

### ベースステート設定アクション

| プロパティ | 説明 |
|-----------|------|
| **ステート** | ウィジェットの新しいベースステート |

---

## アセットブラウザ

### 画像ブラウザ

`images/`フォルダ内のすべての画像を閲覧:

- **ページネーション**: 画像のページをナビゲート
- **プレビュー**: 画像のパスと詳細を表示
- **選択**: クリックして現在のコンテキストで使用

画像はフォルダ別に整理されています（例: `template/button.png`）。

### サウンドブラウザ

`sounds/`フォルダ内のすべてのサウンドとMinecraftの組み込みサウンドを閲覧:

- **カスタムサウンド**: `sounds/`からの.oggファイル
- **Minecraftサウンド**: 組み込みサウンド（minecraft:ui.button.clickなど）
- **選択**: クリックして現在のコンテキストで使用

---

## ヒントとベストプラクティス

### ワークフローのヒント

1. **プロパティから始める**: まず名前、タイトル、ロケーションを設定
2. **ウィジェットを追加**: 基本的なトランスフォームでウィジェットを作成
3. **ビジュアルを設定**: 通常とホバーステートを設定
4. **コリジョンを追加**: コリジョンボックスを有効にしてサイズを設定
5. **イベントを追加**: ホバーサウンドとクリックアクションを設定
6. **頻繁にテスト**: `/cm hiraku <menu>`を使用して変更をテスト

### キーボードショートカット

| ショートカット | アクション |
|--------------|---------|
| **Escape** | エディターを閉じる |
| **数字キー (1-9)** | クイックスロット選択 |

### よくある問題

**変更が反映されない:**
- 変更後に`/cm saiload`を実行
- エディターで「保存」をクリックしたことを確認

**コリジョンが検出されない:**
- コリジョンが有効になっているか確認
- コリジョンサイズが十分に大きいか確認
- `/cm debaggu particles`を使用して視覚化

**画像が表示されない:**
- `/cm pakku`を実行してリソースパックを再生成
- 画像がサブフォルダにあることを確認（例: `images/mymenu/`）
- クライアントにリソースパックを適用

---

## 関連項目

- [コマンドリファレンス](commands.md)
- [メニュー作成](menu-creation.md)
- [ウィジェットタイプ](widgets.md)
- [イベントシステム](events.md)
- [アニメーション](animations.md)
